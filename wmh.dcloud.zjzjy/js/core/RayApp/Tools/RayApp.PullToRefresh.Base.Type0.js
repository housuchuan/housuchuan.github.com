define(function(require,exports,module){"use strict;";var t=require("CommonTools_Core"),o={},i={down:{height:75,contentdown:"下拉可以刷新",contentover:"释放立即刷新",contentrefresh:"正在刷新",callback:t.noop},up:{auto:!1,offset:100,show:!0,contentdown:"上拉显示更多",contentrefresh:"正在加载...",contentnomore:"没有更多数据了",callback:t.noop},element:"#pullrefresh"};!function($,t,i){var e="mui-pull-top-pocket",n="mui-pull-bottom-pocket",s="mui-pull",l="mui-pull-loading",r="mui-pull-caption",h="mui-pull-caption-down",a="mui-pull-caption-refresh",c="mui-pull-caption-nomore",u="mui-icon",p="mui-spinner",d="mui-icon-pulldown",f="mui-block",m="mui-hidden",w="mui-visibility",k=l+" "+u+" "+d,P=l+" "+u+" "+d,b=l+" "+u+" "+p,g=['<div class="'+s+'">','<div class="{icon}"></div>','<div class="'+r+'">{contentrefresh}</div>',"</div>"].join(""),v={init:function(t,o){this._super(t,$.extend(!0,{scrollY:!0,scrollX:!1,indicators:!0,deceleration:.003,down:{height:50,contentinit:"下拉可以刷新",contentdown:"下拉可以刷新",contentover:"释放立即刷新",contentrefresh:"正在刷新..."},up:{height:50,auto:!1,contentinit:"上拉显示更多",contentdown:"上拉显示更多",contentrefresh:"正在加载...",contentnomore:"没有更多数据了",duration:300}},o))},_init:function(){this._super(),this._initPocket()},_initPulldownRefresh:function(){this.pulldown=!0,this.pullPocket=this.topPocket,this.pullPocket.classList.add(f),this.pullPocket.classList.add(w),this.pullCaption=this.topCaption,this.pullLoading=this.topLoading},_initPullupRefresh:function(){this.pulldown=!1,this.pullPocket=this.bottomPocket,this.pullPocket.classList.add(f),this.pullPocket.classList.add(w),this.pullCaption=this.bottomCaption,this.pullLoading=this.bottomLoading},_initPocket:function(){var t=this.options;t.down&&t.down.hasOwnProperty("callback")&&(this.topPocket=this.scroller.querySelector("."+e),this.topPocket||(this.topPocket=this._createPocket(e,t.down,P),this.wrapper.insertBefore(this.topPocket,this.wrapper.firstChild)),this.topLoading=this.topPocket.querySelector("."+l),this.topCaption=this.topPocket.querySelector("."+r)),t.up&&t.up.hasOwnProperty("callback")&&(this.bottomPocket=this.scroller.querySelector("."+n),this.bottomPocket||(this.bottomPocket=this._createPocket(n,t.up,b),this.scroller.appendChild(this.bottomPocket)),this.bottomLoading=this.bottomPocket.querySelector("."+l),this.bottomCaption=this.bottomPocket.querySelector("."+r),this.wrapper.addEventListener("scrollbottom",this))},_createPocket:function(o,i,e){var n=t.createElement("div");return n.className=o,n.innerHTML=g.replace("{contentrefresh}",i.contentinit).replace("{icon}",e),n},_resetPullDownLoading:function(){var t=this.pullLoading;t&&(this.pullCaption.innerHTML=this.options.down.contentdown,t.style.webkitTransition="",t.style.webkitTransform="",t.style.webkitAnimation="",t.className=P)},_setCaptionClass:function(t,o,i){if(!t)switch(i){case this.options.up.contentdown:o.className=r+" "+h;break;case this.options.up.contentrefresh:o.className=r+" "+a;break;case this.options.up.contentnomore:o.className=r+" "+c}},_setCaption:function(t,o){if(!this.loading){var i=this.options,e=this.pullPocket,n=this.pullCaption,s=this.pullLoading,l=this.pulldown,r=this;e&&(o?setTimeout(function(){n.innerHTML=r.lastTitle=t,l?s.className=P:(r._setCaptionClass(!1,n,t),s.className=b),s.style.webkitAnimation="",s.style.webkitTransition="",s.style.webkitTransform=""},100):t!==this.lastTitle&&(n.innerHTML=t,l?t===i.down.contentrefresh?(s.className=b,s.style.webkitAnimation="spinner-spin 1s step-end infinite"):t===i.down.contentover?(s.className=k,s.style.webkitTransition="-webkit-transform 0.3s ease-in",s.style.webkitTransform="rotate(180deg)"):t===i.down.contentdown&&(s.className=P,s.style.webkitTransition="-webkit-transform 0.3s ease-in",s.style.webkitTransform="rotate(0deg)"):(t===i.up.contentrefresh?s.className=b+" "+w:s.className=b+" "+m,r._setCaptionClass(!1,n,t)),this.lastTitle=t))}}};o.PullRefresh=v}(mui,document),function($,e,n,s){var l="mui-visibility",r="mui-hidden",h=$.Scroll.extend($.extend({handleEvent:function(t){this._super(t),"scrollbottom"===t.type&&t.target===this.scroller&&this._scrollbottom()},_scrollbottom:function(){this.pulldown||this.loading||(this.pulldown=!1,this._initPullupRefresh(),this.pullupLoading())},_start:function(t){t.touches&&t.touches.length&&t.touches[0].clientX>30&&t.target&&!this._preventDefaultException(t.target,this.options.preventDefaultException)&&t.preventDefault(),this.loading||(this.pulldown=this.pullPocket=this.pullCaption=this.pullLoading=!1),this._super(t)},_drag:function(t){this._super(t),!this.pulldown&&!this.loading&&this.topPocket&&"down"===t.detail.direction&&this.y>=0&&this._initPulldownRefresh(),this.pulldown&&this._setCaption(this.y>this.options.down.height?this.options.down.contentover:this.options.down.contentdown)},_reLayout:function(){this.hasVerticalScroll=!0,this._super()},resetPosition:function(t){if(this.pulldown){if(this.y>=this.options.down.height)return this.pulldownLoading(s,t||0),!0;!this.loading&&this.topPocket.classList.remove(l)}return this._super(t)},pulldownLoading:function(t,o){if("undefined"==typeof t&&(t=this.options.down.height),this.scrollTo(0,t,o,this.options.bounceEasing),!this.loading){this._initPulldownRefresh(),this._setCaption(this.options.down.contentrefresh),this.loading=!0,this.indicators.map(function(t){t.fade(0)});var i=this.options.down.callback;i&&i.call(this)}},endPulldownToRefresh:function(){var t=this;t.topPocket&&t.loading&&this.pulldown&&(t.scrollTo(0,0,t.options.bounceTime,t.options.bounceEasing),t.loading=!1,t._setCaption(t.options.down.contentdown,!0),setTimeout(function(){t.loading||t.topPocket.classList.remove(l)},350))},pullupLoading:function(t,o,i){if(this.options.up){if(this.finished&&this.refresh(!0),o=o||0,this.scrollTo(o,this.maxScrollY,i,this.options.bounceEasing),this.loading)return;this._initPullupRefresh(),this._setCaption(this.options.up.contentrefresh),this.indicators.map(function(t){t.fade(0)}),e.plus&&"Android"===plus.os.name||this.scrollTo(0,0,100),this.loading=!0,t=t||this.options.up.callback,t&&t.call(this)}},endPullupToRefresh:function(t){var o=this;o.bottomPocket&&(o.loading=!1,t?(this.finished=!0,o._setCaption(o.options.up.contentnomore),o.wrapper.removeEventListener("scrollbottom",o)):(o._setCaption(o.options.up.contentdown),o.loading||o.bottomPocket.classList.remove(l)))},disablePullupToRefresh:function(){this._initPullupRefresh(),this.bottomPocket.className="mui-pull-bottom-pocket "+r,this.wrapper.removeEventListener("scrollbottom",this)},enablePullupToRefresh:function(){this._initPullupRefresh(),this.bottomPocket.classList.remove(r),this._setCaption(this.options.up.contentdown),this.wrapper.addEventListener("scrollbottom",this)},refresh:function(t){t&&this.finished&&(this.enablePullupToRefresh(),this.finished=!1),this._super()},resetLoadingState:function(t,o){var i=this;t&&this.endPulldownToRefresh(),o?this.endPullupToRefresh(!0):(i.finished&&this.refresh(!0),this.endPullupToRefresh(!1))},endPullDownToRefresh:function(){var t=this;t.resetLoadingState(!0,!1)},endPullUpToRefresh:function(t){var o=this;o.resetLoadingState(!1,t)}},o.PullRefresh));exports.initPullToRefresh=function(o,e){var s=null;e=t.extend(!0,{},i,e);var l;return"object"!=typeof o?l=o:(e=o,l=e.element),l=l||i.element,"string"==typeof l&&(l=n.querySelector(l)),l?(s=new h(l,e),e.down&&e.down.auto?s.pulldownLoading(e.down.autoY):e.up&&e.up.auto&&s.pullupLoading(),s):(console.error("错误,下拉刷新容器为空!"),s)}}(mui,window,document)});