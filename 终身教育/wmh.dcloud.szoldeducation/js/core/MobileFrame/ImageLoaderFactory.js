define(function(require,g,b){var h=require("core/MobileFrame/CommonUtil");var e=require("core/MobileFrame/DownLoadUtil");var c={downloadStoragePath:"_downloads/imgs/",fileCacheTimeStamp:1000*60*60*24*1,concurrentDownloadCount:3,timeout:3,retryInterval:3,maxTimeSingleDownloadTaskSpend:1000*10,defaultImgBase:h.getProjectBasePath()+"img/MobileFrame/",loadingImgName:"img_loading.jpg",errorImgName:"img_error.jpg",isUseMinLoading:false,getRelativePathFromLoadUrlCallback:f};var j=c.defaultImgBase+c.loadingImgName;var k=c.defaultImgBase+c.errorImgName;function f(q){var r=q.substring(q.lastIndexOf(".")+1,q.length);if(r.toLocaleLowerCase()!=("jpg")&&r.toLocaleLowerCase()!=("jpeg")&&r.toLocaleLowerCase()!=("png")&&r.toLocaleLowerCase()!=("bmp")&&r.toLocaleLowerCase()!=("svg")&&r.toLocaleLowerCase()!=("gif")){r="jpg"}var p=/[&\|\\\*^%$#@\-:.?\/=!]/g;var o=q.replace(p,"");o=o.trim();if(o.length>100){o=o.substr(o.length-100,o.length)}var n=o+"."+r;var m=c.downloadStoragePath+n;return m}function a(m,o,n){if(!m||!(m instanceof HTMLElement)){return}if(o==j){if(c.isUseMinLoading==true){m.style.maxWidth="30px"}else{m.style.maxWidth="100%"}}else{m.style.maxWidth="100%"}if(!n){o=h.changImgUrlTypeWithRandomKey(o)}if(m.tagName.toLocaleLowerCase()=="img"){m.setAttribute("src",o)}else{m.style.backgroundImage="url("+o+")"}}g.setOptions=function(m){if(!m){return}for(var n in c){if(m[n]!=null){c[n]=m[n]}}j=c.defaultImgBase+c.loadingImgName;k=c.defaultImgBase+c.errorImgName};g.clearLoaderImgsCache=function(m,n){e.setOptions(c);e.clearAllLocalFileCache();e.RestoreOptions()};g.clearNetUrlImgCache=function(o,m,n){e.clearNetUrlFileCache(o,m,n)};g.setImgWidthLocalCache=function(n,o,m){if(o==null){return}if(window.plus&&!m){e.setOptions(c);e.downloadFileWidthLocalCache(o,{beforeDownload:function(){a(n,j)},successDownload:function(q,p){if(p==true){h.plusReady(function(){var r=plus.io.convertLocalFileSystemURL(q);a(n,r)})}else{a(n,k)}},errorDownload:function(p){a(n,k)}})}else{a(n,j);if(o){a(n,o,true);n.onerror=function(){this.src=k}}else{a(n,k)}}};g.setAllNetImgsWithLocalCache=function(){var n=document.querySelectorAll("img");h.each(n,function(o,p){var q=this.getAttribute("data-img-localcache");if(q!=null&&q!=""){g.setImgWidthLocalCache(this,q)}});var m=document.querySelectorAll(".img-localcache-background");h.each(m,function(o,p){var q=this.getAttribute("data-img-localcache");if(q!=null&&q!=""){g.setImgWidthLocalCache(this,q)}})};function l(r,p){var q=document.documentElement.clientHeight;var s=document.body.scrollTop;q=q;var o=r.getBoundingClientRect().top;var n=r.offsetHeight;if(o<(q+n)&&o+n>=0){var m=r.getAttribute("data-img-localcache");if(!r.getAttribute("src")){g.setImgWidthLocalCache(r,m,p)}}}function i(m){var o=document.querySelectorAll("img");var n=document.querySelectorAll(".img-localcache-background");h.each(o,function(p,q){l(this,m)});h.each(n,function(p,q){l(this,m)})}g.lazyLoadAllImg=function(m){var n=function(){i(m)};i(m);document.onscroll=n;n()}});