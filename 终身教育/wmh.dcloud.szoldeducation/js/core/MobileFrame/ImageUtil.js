define(function(require,a,d){var b=require("core/MobileFrame/CommonUtil");a.getCompressImage=function(e,g,l,q){q=q||{};var h=e.substr(e.lastIndexOf("/")+1);var m=e.substring(0,e.lastIndexOf("/")+1);var o=m+"tmp"+h;var i={src:e,dst:o,overwrite:true};if(q.compressQuality&&typeof(q.compressQuality)=="number"&&q.compressQuality>0){i.quality=q.compressQuality}else{var k=(typeof(q.maxWidth)=="string"&&parseInt(q.maxWidth)>0)?q.maxWidth:"500";var j=(typeof(q.maxHeight)=="string"&&parseInt(q.maxHeight)>0)?q.maxHeight:"333";i.width=k;i.height=j}plus.zip.compressImage(i,function(){if(g&&typeof(g)=="function"){g(o)}},function(f){if(l&&typeof(l)=="function"){l("压缩图片失败!"+JSON.stringify(f)+",path:"+o)}})};a.getMaxSizeImg=function(h,e,f,g){g=g||{};var i=(g.maxSize&&typeof(g.maxSize)=="number"&&g.maxSize>0)?g.maxSize:150*1024;plus.io.resolveLocalFileSystemURL(h,function(j){j.file(function(l){var k=h;if(l.size>i){var m=Math.round((i/l.size)*100);a.getCompressImage(h,function(n){k=n;if(e&&typeof(e)=="function"){e(k)}},f,{compressQuality:m})}else{k=h;if(e&&typeof(e)=="function"){e(k)}}})},function(){if(f&&typeof(f)=="function"){f("打开文件路径失败")}})};(function(f){f.SelectImgFromCamera=function(i,g,h){h=h||{};b.plusReady(function(){plus.camera.getCamera().captureImage(function(k){if(i&&typeof(i)=="function"){var j="file://"+plus.io.convertLocalFileSystemURL(k);i(j)}},function(){if(g&&typeof(g)=="function"){g("选择图片失败!")}},h)})};f.SelectImgFromGallery=function(i,g,h){h=h||{};b.plusReady(function(){plus.gallery.pick(function(k){if(typeof(k)=="string"){if(i&&typeof(i)=="function"){i(k)}}else{var l=[];for(var j in k.files){l.push(k.files[j])}if(i&&typeof(i)=="function"){i(l)}}},function(){if(g&&typeof(g)=="function"){g("选择图片失败!")}},h)})};f.SelectCompressImgFromCamera=function(g,h,i){f.SelectImgFromCamera(function(j){a.getMaxSizeImg(j,g,h,i)},h,i)};f.SelectCompressImgFromGallery=function(g,h,i){f.SelectImgFromGallery(function(j){if(typeof(j)=="string"){a.getMaxSizeImg(j,g,h,i)}else{e(j,g,h,i)}},h,i)};function e(l,h,i,j){var k=[];function g(){var m=l.pop();if(m){a.getMaxSizeImg(m,function(n){k.push(n);g()},i,j)}else{if(h&&typeof(h)=="function"){h(k)}}}g()}})(a.ImageSelectFactory={})});