define(function(require,c,a){var d=require("core/MobileFrame/CommonUtil");var i=require("core/MobileFrame/StorageUtil");var h=[];var g={top:"0px",bottom:"0px",scrollIndicator:"none",scalable:false,popGesture:"close",aniShow:"none",duration:300,waiting:{autoShow:false,title:"正在打开页面...",options:{size:"20px",padlock:false,modal:false,color:"#ffff00",background:"rgba(0,0,0,0.8)",loading:{display:"inline"}}}};c.setOptions=function(k){g=d.extend(true,{},g,k)};function j(p,u,l){if(!p||!Array.isArray(p)){return}var o="";for(var n=0;n<p.length;n++){var v=p[n];v.id=v.id||v.url;o+=v.id+",";var r=null;if(l){if(typeof l=="string"){l=document.querySelector(l)}r=l}var k=document.createElement("div");k.className="mui-iframe-wrapper";k.id=v.id;var t=v.styles||{};if(typeof t.top!=="string"){t.top="0px"}if(typeof t.bottom!=="string"){t.bottom="0px"}if(typeof t.left!=="string"){t.left="0px"}if(typeof t.right!=="string"){t.right="0px"}k.style.zIndex=t.zindex||0;k.style.position="fixed";k.style.top=t.top;k.style.bottom=t.bottom;k.style.left=t.left;k.style.right=t.right;k.style["-webkit-overflow-scrolling"]="touch";var m=document.createElement("iframe");var q="";if(q.indexOf("?")==-1&&v.url.indexOf("?")==-1){q+="?"}else{q+="&"}q+="H5PageId="+v.id;if(p[n].extras){for(var s in p[n].extras){q+="&";q+=s+"="+p[n].extras[s]}}m.src=v.url+q;m.name=v.id;m.style.border="0px";k.appendChild(m);document.body.appendChild(k);if(n==0){if(u==true){k.style.display="block"}else{k.style.display="none"}}else{k.style.display="none"}document.body.style["overflow-x"]="hidden";document.body.style["overflow-y"]="hidden";d.os.wechat&&f(k,m);if(r){r.appendChild(k)}h.push({iframe:m,styles:t})}return o}function f(n,l){var k="MUI_SCROLL_POSITION_"+document.location.href+"_"+l.src;var m=(parseFloat(localStorage.getItem(k))||0);if(m){(function(o){l.onload=function(){window.scrollTo(0,o)}})(m)}setInterval(function(){var o=window.scrollY;if(m!==o){localStorage.setItem(k,o+"");m=o}},100)}c.createWinWithStyle=function(l,k,n,v,t,o){if(typeof k==="undefined"){console.error("错误:创建窗口的url不能为空");return}n=n||{};l=l||k;var r="";if(r.indexOf("?")==-1&&k.indexOf("?")==-1){r+="?"}else{r+="&"}r+="H5PageId="+l;for(var w in n){r+="&";r+=w+"="+n[w]}if(!d.os.plus){var u=i.getStorageItem("Html5_Compatible_PageStack")||{};var m=e(k+r);if(u[window.id]!=null){u[window.id]["nextHref"]=k+r}else{u[window.id]={href:window.location.href,nextHref:k+r}}u[m]={href:k+r,beforeHref:window.location.href};i.setStorageItem("Html5_Compatible_PageStack",u);if(d.os.ios||d.os.android){window.top.location.href=k+r}else{window.parent.location.href=k+r}console.log("目标url:"+k+r);return}v=v||{};v=d.extend(true,{},g,v);var q=plus.webview.getWebviewById(l);if(q){q.show(v.aniShow,v.duration,function(){t&&t()});return q}else{q=plus.webview.create(k,l,v,n);var p=v.waiting;var s=null;if(p.autoShow){s=plus.nativeUI.showWaiting(p.title,p.options)}q.addEventListener("loaded",function(){if(s){s.close()}q.show(v.aniShow,v.duration,function(){t&&t()})},false);q.addEventListener("close",function(){o&&o();q=null},false)}};c.createWin=function(p,l,m,n,k,o){c.createWinWithStyle(p,l,m,n,k,o)};c.showWin=function(l){var k=plus.webview.getWebviewById(l);if(k){k.show(g)}};c.createWinWithTopBottom=function(r,m,n,o,l,p,q,k){q=q||"0px";k=k||"0px";c.createWinWithStyle(r,m,n,{top:q,bottom:k},l,p)};c.createFloatWin=function(p,l,m,n,k,o){c.createWinWithStyle(p,l,m,{width:"80%",height:"80%",margin:"auto",background:"rgba(0,0,0,0.8)"},k,o)};c.createSubWins=function(u,s,n){if(!d.isArray(u)){console.error("错误:子页面和样式不为数组,传入格式错误!");return}s=(typeof(s)=="boolean")?s:true;var p="";if(window.plus){var t=plus.webview.currentWebview();for(var o=0;o<u.length;o++){p+=u[o].id||u[o].url+",";var r={};var q=u[o].styles?u[o].styles:u[0].styles;var m=u[o].extras||{};var l=u[o].id||u[o].url;var k=plus.webview.create(u[o].url,l,q,m);t.append(k);if(o>0){k.hide()}else{if(!s){k.hide()}else{k.show(g)}}}}else{p=j(u,s,n)}return p};c.firePageEvent=function(o,m,l){if(window.plus){if(!d.IsInclude("mui.min.js")){console.error("错误:mui不存在,无法触发事件");return}var k=plus.webview.getWebviewById(o);if(!k){console.error("界面不存在，调用无效,Page:"+o);return}l=l||{};m=m||"refreshListPage";mui.fire(k,m,l)}else{if(window.id==o){c.trigger(document,m,l)}else{var n=document.getElementById(o);if(n){n=window.frames[o];c.trigger(n,m,l)}else{console.error("触发自定义事件出错,触发对应的window的id不是本页面或者不是本页面的子页面,h5模式下无法触发其它历史页面!")}}}};c.changeSubPageShow=function(l,m,k){c.hideSubPage(m);c.showSubPage(l);k&&k(l)};c.showSubPage=function(l){if(window.plus){var k=plus.webview.getWebviewById(l);if(!k){console.error("plus情况子页面显示时错误:"+l+"页面不存在!");return}plus.webview.show(k)}else{var k=document.getElementById(l);if(!k){console.error("h5情况子页面显示时错误:"+l+"页面不存在!");return}k.style.display="block"}};c.hideSubPage=function(l){if(window.plus){var k=plus.webview.getWebviewById(l);if(!k){console.error("plus情况子页面隐藏时错误:"+l+"页面不存在!");return}plus.webview.hide(k)}else{var k=document.getElementById(l);if(!k){console.error("h5情况子页面隐藏时错误:"+l+"页面Iframe不存在!");return}k.style.display="none"}};c.trigger=function(l,k,m){l.dispatchEvent(new CustomEvent(k,{detail:m,bubbles:true,cancelable:true}));return this};function e(l){var k=d.getUrlParamsValue(l,"H5PageId");var m=k!=="undefined"?k:"H5index.html";return m}c.getExtraDataByKey=function(k){if(!k){return null}var l=null;if(window.plus){l=plus.webview.currentWebview()[k]}else{l=d.getUrlParamsValue(window.location.href,k)}if(l==="undefined"){l=null}return l};c.dbClickExit=function(k,l){var m=null;k=k||"再按一次退出应用";l=l||1000;mui.back=function(){if(!m){m=new Date().getTime();mui.toast(k);setTimeout(function(){m=null},l)}else{if(new Date().getTime()-m<l){plus.runtime.quit()}}}};(function(){function l(p,q){q=q||{bubbles:false,cancelable:false,detail:undefined};var n=document.createEvent("HTMLEvents");var m=true;for(var o in q){(o==="bubbles")?(m=!!q[o]):(n[o]=q[o])}n.initEvent(p,m,true);return n}l.prototype=window.Event.prototype;if(typeof window.CustomEvent==="undefined"){window.CustomEvent=l}window.id=e(window.location.href);if(window.mui){var k=mui.back;mui.back=function(){if(!d.os.plus){var m=i.getStorageItem("Html5_Compatible_PageStack")||{};var n=d.os.name;if(n.indexOf("browser")!=-1&&n.indexOf("browserQQ")!=-1&&n.indexOf("mobile")!=-1&&n.indexOf("mobileQQClient")!=-1){if(m[window.id]&&m[window.id]["beforeHref"]){window.parent.location.href=m[window.id]["beforeHref"]}else{k&&k()}}else{k&&k()}}else{k&&k()}}}})()});