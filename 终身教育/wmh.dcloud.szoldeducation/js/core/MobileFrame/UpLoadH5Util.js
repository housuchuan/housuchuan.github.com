define(function(require,a,d){var f=require("core/MobileFrame/CommonUtil");var b={url:"",timeout:10,data:{},files:null,successCallback:f.noop,errorCallback:f.noop,beforeUploadCallback:f.noop,uploadingCallback:f.noop,ListenerProgressStep:5};function e(h){var g=this;g.options=f.extend(true,{},b,h);g.init()}e.prototype.init=function(){var k=this;k.previousLoadedBytes=0;k.previousTimeStamp=(new Date()).valueOf();k.speedStr=0;var h=new FormData();for(var n in k.options.data){h.append(n,k.options.data[n])}var j=k.options.files;if(j){for(var l=0,g=j.length;l<g;l++){h.append(j[l].name,j[l].file)}}var o=new XMLHttpRequest();var m=0;o.upload.addEventListener("progress",function(r){var q=(new Date()).valueOf();if(q-k.previousTimeStamp>1000){var p=(r.loaded-k.previousLoadedBytes)*1000/(q-k.previousTimeStamp);k.previousLoadedBytes=r.loaded;k.previousTimeStamp=q;k.speedStr=p.toString()+"B/s";if(p>1024*1024){k.speedStr=(Math.round(iDiff*100/(1024*1024))/100).toString()+"MB/s"}else{if(p>1024){k.speedStr=(Math.round(iDiff*100/1024)/100).toString()+"KB/s"}}}var i=(r.loaded/r.total*100).toFixed(2);if(i-m>=k.options.ListenerProgressStep){m=i;k.options.uploadingCallback(i,"上传中",k.speedStr)}},false);o.addEventListener("load",function(p){var i=null;try{i=JSON.parse(p.target.responseText)}catch(p){}k.options.successCallback(i,p.target.responseText)},false);o.addEventListener("error",function(i){k.options.errorCallback("上传失败",i.target.responseText)},false);o.addEventListener("abort",function(i){k.options.errorCallback("上传中断",i.target.responseText)},false);k.options.beforeUploadCallback();o.open("POST",k.options.url,true);o.send(h)};a.upLoadFiles=function(h){var g=new e(h);return g}});