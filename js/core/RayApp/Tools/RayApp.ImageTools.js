define(function(require,exports,module){"use strict";var e=require("CommonTools_Core");exports.getCompressImage=function(e,t,i,n){n=n||{};var o=e.substr(e.lastIndexOf("/")+1),f=e.substring(0,e.lastIndexOf("/")+1),s=f+"tmp"+o,a={src:e,dst:s,overwrite:!0};if(n.compressQuality&&"number"==typeof n.compressQuality&&n.compressQuality>0)a.quality=n.compressQuality;else{var u="string"==typeof n.maxWidth&&parseInt(n.maxWidth)>0?n.maxWidth:"500",c="string"==typeof n.maxHeight&&parseInt(n.maxHeight)>0?n.maxHeight:"333";a.width=u,a.height=c}plus.zip.compressImage(a,function(){t&&"function"==typeof t&&t(s)},function(e){i&&"function"==typeof i&&i("压缩图片失败!"+JSON.stringify(e)+",path:"+s)})},exports.getMaxSizeImg=function(e,t,i,n){n=n||{};var o=n.maxSize&&"number"==typeof n.maxSize&&n.maxSize>0?n.maxSize:153600;plus.io.resolveLocalFileSystemURL(e,function(n){n.file(function(n){var f=e;if(n.size>o){var s=Math.round(o/n.size*100);exports.getCompressImage(e,function(e){f=e,t&&"function"==typeof t&&t(f)},i,{compressQuality:s})}else f=e,t&&"function"==typeof t&&t(f)})},function(){i&&"function"==typeof i&&i("打开文件路径失败")})},function(t){function i(e,t,i,n){function o(){var s=e.pop();s?exports.getMaxSizeImg(s,function(e){f.push(e),o()},i,n):t&&"function"==typeof t&&t(f)}var f=[];o()}t.selectImgFromCamera=function(t,i,n){n=n||{},e.plusReady(function(){plus.camera.getCamera().captureImage(function(e){if(n.isCompress)exports.getMaxSizeImg(e,t,i,n);else if(t&&"function"==typeof t){var o="file://"+plus.io.convertLocalFileSystemURL(e);t(o)}},function(){i&&"function"==typeof i&&i("选择图片失败!")},n)})},t.selectImgFromGallery=function(t,n,o){o=o||{},e.plusReady(function(){plus.gallery.pick(function(e){if(o.isCompress)"string"==typeof e?exports.getMaxSizeImg(e,t,n,o):i(e,t,n,o);else if("string"==typeof e)t&&"function"==typeof t&&t(e);else{var f=[];for(var s in e.files)f.push(e.files[s]);t&&"function"==typeof t&&t(f)}},function(){n&&"function"==typeof n&&n("选择图片失败!")},o)})}}(exports.ImageSelectTools={})});