define(function(require,exports,module){"use strict";function e(e){var r=typeof e;return"object"===r&&(null===e?r="null":Array.isArray(e)&&(r="array")),r}var r=require("CommonTools_Core");Array.includes||(Array.prototype.includes=function(e){for(var r=0;r<this.length;r++)if(this[r]==e)return!0;return!1}),exports.compareJson=function(e,r,t){try{if(null==e||null==r)throw new Error("错误:比较对象不能为空");var n;return n=Array.isArray(e)&&Array.isArray(r)?exports.compArray(e,r,t):exports.compObj(e,r,t)}catch(o){throw new Error("错误:"+o)}},exports.propertyLength=function(e){var r=0;if(e&&"object"==typeof e){for(var t in e)e.hasOwnProperty(t)&&r++;return r}throw new Error("argunment can not be null;")},exports.compArray=function(e,r,t){if(!(e&&"object"==typeof e&&Array.isArray(e)&&r&&"object"==typeof r&&Array.isArray(r)))throw new Error("argunment is  error,not Array ;");if("simpleStruct"===t||"deepStruct"===t){var n=exports.compObj(e[0],r[0],t);return!!n}if(e.length!=r.length)return!1;for(var o=0;o<e.length;o++){var n=exports.compObj(e[o],r[o],t);if(!n)return!1}return!0},exports.compObj=function(e,r,t){if(!e||"object"!=typeof e||!r||"object"!=typeof r)return!(!e||"object"==typeof e||!r||"object"==typeof r)&&("simpleStruct"===t||"deepStruct"===t||!(!e||!r||typeof e!=typeof r||e!==r));var n=exports.propertyLength(e),o=exports.propertyLength(r);if(n!=o)return!1;for(var a in e){if(!e.hasOwnProperty(a)||!r.hasOwnProperty(a))return!1;if("simpleStruct"===t)return!0;if(Array.isArray(e[a])&&Array.isArray(r[a])){if(!exports.compArray(e[a],r[a],t))return!1}else if("object"==typeof e[a]&&"object"==typeof r[a]){if(!exports.compObj(e[a],r[a],t))return!1}else{if(!e[a]||"object"==typeof e[a]||!r[a]||"object"==typeof r[a])return!1;if("deepStruct"===t)continue;if(e[a]!==r[a])return!1}}return!0},exports.JsonAnalysis=function(){var t="_root_",n="_empty_",o=" ► ",a=function(e){return e?e+o:t},s={keyPaths:[],keyNames:[]},i=function(e){s.keyPaths.includes(e)||s.keyPaths.push(e)},c=function(e){s.keyNames.includes(e)||s.keyNames.push(e)},u=function(){s.keyPaths.forEach(function(e,r){for(var t=e.split(o),n=t.length,r=0;r<n;r++)c(t[r])})},y=["string","number","boolean",n],f=function(r,s){var s=a(s),c=n,u=e(r);if(s==t&&(s=t+"{"+u+"}"+o),"array"===u)r.length&&(c=e(r[0])),s=s.substring(0,s.length-o.length-1),s+="&lt;"+c+"&gt;}",y.includes(c)?i(s):f(r[0],s);else if("object"===u){var l=Object.keys(r);l.length?l.forEach(function(t,n){var o=r[t];c=e(o),y.includes(c)?i(s+t+"{"+c+"}"):f(o,s+(t+"{"+c+"}"))}):i(s.substring(0,s.length-o.length-1)+"&lt;"+c+"&gt;}")}};return{analysis:function(e){f(e),u();var t=r.extend(!0,{},s);return t.keyNames.sort(),t.keyPaths.sort(),s={keyPaths:[],keyNames:[]},t},getTypeof:e,SPLIT_CHAR:o}}(),exports.jsonCheck=function(e,r){var t={code:0,description:"",data:null},n=exports.JsonAnalysis.analysis(e),o=exports.JsonAnalysis.analysis(r);if(n.keyNames.join("")===o.keyNames.join("")&&n.keyPaths.join("")===o.keyPaths.join(""))t.code=1,t.description="JSON数据匹配成功!";else{var a=n.keyPaths.length-o.keyPaths.length,s=[],i=[];if(n.keyNames.forEach(function(e,r){o.keyNames.includes(e)||s.push(e)}),o.keyNames.forEach(function(e,r){n.keyNames.includes(e)||s.push(e)}),s.length)s.forEach(function(e,r){for(var t=0,a=n.keyPaths.length;t<a;t++){var s=n.keyPaths[t],c=o.keyPaths[t];s.indexOf(e)!==-1?(s=s.split(e)[0]+'<b class="text-danger">'+e+"</b>",i.includes(s)||i.push(s)):c&&c.indexOf(e)!==-1&&(c=c.split(e)[0]+'<b class="text-danger">'+e+"</b>",i.includes(c)||i.push(c))}}),t.code=0,t.description="JSON数据不匹配!",0!==a&&(t.description="两个JSON的字段不一致!"),t.data=i;else{t.code=0,t.description="存在字段缺失现象!";var c=[];n.keyPaths.forEach(function(e,r){o.keyPaths.includes(e)||c.push(e)}),o.keyPaths.forEach(function(e,r){n.keyPaths.includes(e)||c.push(e)}),t.data=c}}return t}});