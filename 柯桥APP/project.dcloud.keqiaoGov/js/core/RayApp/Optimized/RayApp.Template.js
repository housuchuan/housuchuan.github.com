define(function(require,e,b){var h=require("CommonTools_Core");var k=require("WindowTools_Core");var a=null;var j=null;var f=null;var d=document.getElementById("title");h.initReady(g);function g(l){h.importFile(["js/libs/mui.min.js"],function(){if(l){j=plus.webview.currentWebview();f=new plus.nativeObj.Bitmap("RayAppTemplateBitmap")}i()})}function i(){var l=mui.back;mui.back=function(){if(j){j.hide("auto");setTimeout(function(){d.className="mui-title mui-fadeout";d.innerText="";if(a==null){a=j.children()[0]}a.hide("none")},350)}else{l()}};window.addEventListener("triggerTemplateEvent",function(o){var n=o.detail.refreshEventName;var m=o.detail.extras;var p=o.detail.id;if(a&&a.pageId===p){mui.fire(a,n,m)}});window.addEventListener("updateHeader",function(u){var x=u.detail.templateOptions||{};var v=x.title||"";var n=u.detail.id;var p=u.detail.extras||{};var m=u.detail.target;var r=u.detail.aniShow||"none";var o=u.detail.duration||150;d.innerHTML=v;d.className="mui-title mui-fadein";if(a==null){a=j.children()[0]}var t=a.getURL();var s=true;var q=false;var w="";for(var y in p){if(w.indexOf("?")==-1&&m.indexOf("?")==-1){w+="?"}else{w+="&"}w+=y+"="+encodeURIComponent(p[y])}if(m.lastIndexOf("/html/")!==-1&&!(/^(http|https|ftp)/g.test(m))){m=m.substr(m.lastIndexOf("/html/")+1,m.length);m=h.getRealativePath(m)}m+=w;if(a.pageId!==n){a.pageId=n;s=false;k.clearChildrenWebviews(a);a.loadURL(m);a.draw(f,function(){s=true},function(){s=false});q=true}else{k.firePageEvent(a,"loadUrlReady",{extras:p});q=false}setTimeout(function(){var z={acceleration:"auto"};if(f&&s){z.capture=f;z.otherCapture=f}j.show(r,o,function(){!q&&a.show("auto");setTimeout(function(){if(q&&!a.isVisible()){a.show("fade-in",200)}},300)},z)},10)})}});